#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Allow smart-push script to bypass this check
if [ "$SMART_PUSH_BYPASS" = "true" ]; then
  exit 0
fi

# Get the remote and branch being pushed to
remote="$1"
url="$2"

# Read stdin to get ref info
while read local_ref local_sha remote_ref remote_sha; do
  # Check if pushing to main branch
  if [ "$remote_ref" = "refs/heads/main" ]; then
    echo ""
    echo "🚨 BLOCKED: Direct push to main branch detected!"
    echo ""
    echo "✅ Use smart push instead:"
    echo "   git pushup"
    echo "   npm run smart-push"
    echo "   ./scripts/smart-push.sh"
    echo ""
    echo "❌ DON'T use: git push origin main"
    echo ""
    echo "💡 Smart push handles automated version bumps and prevents conflicts"
    echo "📖 See .agent/sop/git-workflow.md for details"
    echo ""
    exit 1
  fi
done

exit 0